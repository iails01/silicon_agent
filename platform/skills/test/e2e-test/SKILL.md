---
name: e2e-test
display_name: "端到端测试"
description: 设计端到端测试场景，验证完整业务流程从入口到出口的正确性
layer: L2
metadata:
  emoji: "🔄"
  tags: ["test", "e2e", "scenario"]
  applicable_roles: ["test"]
---

# 端到端测试

设计并生成端到端测试，验证完整业务流程从用户入口到最终输出的正确性。

## 输入

用户会提供：
- `feature`：功能描述或业务流程
- `api_spec`（可选）：API 接口规范
- `test_env`（可选）：测试环境配置

## 工作流

### Step 1：业务流程梳理

识别端到端测试场景：
- 核心用户旅程（Happy Path）
- 异常中断流程（错误恢复、超时）
- 边界条件场景（空数据、极值、并发）
- 跨模块数据流转验证

### Step 2：测试环境设计

规划测试所需的环境：
- 测试数据准备（Fixture / Factory）
- 外部服务 Mock（第三方 API、消息队列）
- 数据库初始状态
- 环境变量和配置

### Step 3：测试用例编写

为每个场景编写测试用例：
- 前置条件设置（Given）
- 操作步骤（When）—— 按真实用户操作序列
- 断言验证（Then）—— 验证最终状态和副作用
- 清理步骤（Cleanup）

### Step 4：断言策略

设计全面的断言：
- API 响应状态码和 body
- 数据库状态变化
- 副作用验证（发送邮件、消息队列、日志）
- 时序依赖验证（异步操作完成）

### Step 5：执行顺序

按依赖关系排列测试：
1. 基础设施验证（数据库连接、服务可用）
2. 核心流程测试（CRUD 操作）
3. 组合流程测试（多步骤业务流）
4. 异常恢复测试

## 输出格式

```markdown
## 端到端测试报告

### 测试范围
{功能描述}

### 测试场景

| # | 场景 | 类型 | 步骤数 | 优先级 |
|---|------|------|--------|--------|
| 1 | {场景名} | Happy Path | {n} | P0 |
| 2 | {场景名} | 异常恢复 | {n} | P1 |

### 环境依赖
- {依赖1}
- {依赖2}

### 测试数据
{测试数据准备方案}

### 预期结果
- 通过条件：{描述}
- 失败处理：{描述}
```
