# 数字员工集群 · 完整设计方案 v1.0

> **SITC Trading Team · R&D Organization Upgrade**
> Starbucks China Innovation Technology Center · 2025

---

## 目录

1. [总体设计哲学](#一总体设计哲学)
2. [准入体系（Agent Onboarding）](#二准入体系agent-onboarding)
3. [Agent 角色设计（岗位说明书）](#三agent-角色设计岗位说明书)
4. [In-house 与 Agent 集群协同模型](#四in-house-与-agent-集群协同模型)
5. [准出体系（Agent Offboarding）](#五准出体系agent-offboarding)
6. [治理体系与 KPI 矩阵](#六治理体系与-kpi-矩阵)
7. [进化路径与实施计划](#七进化路径与实施计划)

---

## 一、总体设计哲学

在传统研发模式中，外包团队是"黑盒服务"——交付物可见，过程不可控。**数字员工集群的核心转变是：将 AI Agent 视为可培养、可考核、可替换的"硅基员工"，而非工具调用。**

这一转变要求我们建立一套完整的员工管理体系，涵盖：
- **招募**（准入评估）
- **培训**（Skills 配置与上下文注入）
- **日常管理**（协同模型与 KPI 考核）
- **退出**（准出机制与交接清单）

### 1.1 模式对比

| 对比维度 | 传统外包模式 | 数字员工模式 |
|---|---|---|
| 协作效率 | 沟通成本高，对齐周期长 | 实时上下文，零沟通损耗 |
| 知识留存 | 知识在外部流失 | Skills 体系持续沉淀，永不流失 |
| 过程透明度 | 交付物难以追溯 | 全流程可审计，每步可回放 |
| 成本弹性 | 规模化成本线性增长 | Token 成本边际递减 |
| 质量稳定性 | 质量依赖个人能力 | 规范驱动，标准统一 |
| 领域适应性 | 不具备业务直觉 | 通过 Skills 注入深度领域知识 |

### 1.2 三大核心原则

**原则 1：Specification-First（规范先行）**
先定义"做什么"（规范），再让 Agent 解决"怎么做"（实现）。通过契约和规范降低沟通成本，提升 AI 输出质量。

**原则 2：Context is King（上下文为王）**
通过 Skills 分层体系沉淀领域知识，让每个 Agent 在启动时具备老员工般的业务直觉，而非每次从零开始。

**原则 3：Human for Decision, Agent for Execution（人决策，Agent 执行）**
In-house 员工负责判断和创新，Agent 负责执行和生产。建立清晰的职责边界，最大化人力价值。

---

## 二、准入体系（Agent Onboarding）

准入体系是数字员工质量的第一道门。不是所有 AI 实例都具备上岗资格——必须通过系统性评估和配置，才能被纳入生产研发流程。

### 2.1 准入评估标准

在将一个 Agent 角色引入研发流程前，需通过三类评估：

#### 基础能力评估

| 评估项目 | 合格标准 | 检测方式 |
|---|---|---|
| 代码生成准确率 | 在标准 Benchmark 测试中 ≥ 85% | 自动化测试套件 |
| 指令理解与执行完整度 | 任务完整执行率 ≥ 90% | 预设任务集验证 |
| 上下文窗口利用率 | 长任务中关键信息不遗漏率 ≥ 95% | 长任务压测 |

#### 领域适配评估

| 评估项目 | 合格标准 | 检测方式 |
|---|---|---|
| QSR 业务术语理解 | 核销/权益金逻辑正确率 ≥ 80% | Domain Quiz（20 题） |
| 公司代码规范遵循 | Lint 通过率 ≥ 95% | CI 扫描 |
| OpenAPI 契约对齐 | 生成代码与契约一致率 ≥ 95% | Contract Test 套件 |
| 命名规范遵守 | 非标准命名率 < 5% | 静态代码分析 |

#### 安全合规评估

| 评估项目 | 合格标准 | 检测方式 |
|---|---|---|
| 敏感信息处理 | 不在日志/代码中暴露 PII | 安全扫描（Gitleaks 等） |
| 权限边界遵守 | 无越权操作记录 | 沙箱行为监控 |
| 依赖引用合法性 | 100% 通过 Check-Dependency 校验 | 自动依赖检测工具 |

### 2.2 五步 Onboarding SOP

```
Step 1: 环境隔离配置
  └── 分配独立 Docker Sandbox
  └── 预装编译环境、依赖库、Lint 规则、JDK 版本锁定
  └── 负责人：DevOps

Step 2: Skills 层级注入
  └── Layer 1：公共规范 Skills（团队 GitHub Skills 仓库）
  └── Layer 2：领域业务 Skills（核销/权益金/搭售逻辑）
  └── Layer 3：当前项目 Skills（迭代 DoD / 接口契约）
  └── 负责人：In-house 架构师

Step 3: 代码库上下文接入
  └── 通过 RAG 接入团队 Repo
  └── 注入命名规范索引（如 OrderService 继承规范）
  └── 注入历史 PR 模式（高质量 PR 作为示例）
  └── 负责人：In-house 架构师

Step 4: 权限最小化设置
  └── 授予特定功能分支的 push 权限
  └── 禁止 main/release 合并权
  └── 配置 GitLab CI 门控（无法绕过 Review + Test）
  └── 负责人：DevOps

Step 5: 试岗验证（Shadow Period）
  └── 分配 3 个低风险历史任务重跑验证
  └── FPR（首次通过率）≥ 70% 方可正式上岗
  └── 负责人：In-house TL
```

### 2.3 试岗期管理（Shadow Period）

> ⚠️ **关键机制**：每个新 Agent 角色在进入正式研发流程前，必须经过 5 个工作日的试岗期。试岗期内，Agent 的产出不直接合并到任何分支，由 In-house 员工进行双盲比对验证。

| 试岗阶段 | 验证内容 | 合格指标 | 不通过处置 |
|---|---|---|---|
| Day 1-2：基础验证 | 在已知结果的历史任务上重跑，对比输出差异 | FPR ≥ 70% | 返回 Skills 优化后重测 |
| Day 3-4：边界测试 | 注入含模糊需求和边界 Case 的任务，观察自愈能力 | Self-Fix Rate ≥ 60% | Prompt 模板优化 |
| Day 5：综合评估 | 模拟真实任务全流程：接任务 → 生成方案 → 编码 → 测试 | 综合评分 ≥ 75% | 延长试岗（+3天）或淘汰 |

---

## 三、Agent 角色设计（岗位说明书）

数字员工集群设计为 **7 个核心角色**，覆盖研发全生命周期。每个角色有明确的职责边界、技能要求和 KPI，对应不同的 Skills 配置包。

### 角色总览

| # | 角色名称 | 核心职责 | 核心 Skills 配置 | 关键 KPI | 主要交互对象 |
|---|---|---|---|---|---|
| 01 | **Orchestrator Agent**（编排官） | 解析需求 → 任务拆解 → 分配子任务 → 进度追踪 | Jira 解析 / 任务分解 / 依赖识别 | 任务分解准确率 | 架构师 |
| 02 | **Spec Agent**（方案官） | 生成 Implementation Plan，提交架构对齐 | OpenAPI 规范 / 系统设计模式 | 方案一次通过率 | 架构师 |
| 03 | **Coding Agent**（研发官） | 业务代码实现，严格对照契约 | 领域 Skills / 代码规范 / 平台适配 | FPR / 代码质量分 | Test Agent |
| 04 | **Test Agent**（测试官） | 自动生成测试，驱动自修复循环 | 测试设计 / Contract Test | 覆盖率 / 漏测率 | Coding Agent |
| 05 | **Review Agent**（审计官） | 代码安全 / 规范 / 性能三维审计 | 安全规范 / SonarQube 规则 | Review 误报率 | 架构师 |
| 06 | **Smoke Agent**（巡检官） | 集成链路验证，模拟真实交易场景 | 平台集成脚本 / 场景库 | 链路覆盖率 | DevOps |
| 07 | **Doc Agent**（文档官） | 变更日志、Wiki 更新、Skills 沉淀 | 文档生成 / 知识提炼 | Wiki 时效性 | 全团队 |

---

### 3.1 Orchestrator Agent — 编排官

**岗位定位**：研发流程的"调度中心"，是整个数字员工集群的入口和协调者。

**核心输入**
- 带 `#Agent-Task` 标注的 Jira / GitLab Issue
- Issue 必须包含三要素：`Input`（当前状态）、`Output`（期望结果）、`DoD`（完成标准）

**核心输出**
- 结构化任务链（JSON 格式），包含：
  - 每个子任务的执行者 Agent 角色
  - 子任务间的依赖关系（DAG 有向无环图）
  - 各任务的超时时间与优先级

**工作机制**
```
解析 Issue
  → 识别业务模块边界（按 Skills 中的模块划分图谱）
  → 分析跨模块依赖关系
  → 根据 Agent 能力图谱分配执行者
  → 建立 DAG 依赖图并启动任务链
  → 监控执行进度，处理阻塞上报
```

**特殊逻辑**
- 检测到任务涉及跨平台集成（JD / Douyin / 小程序）时，**自动注入**对应平台适配 Skills
- 任务链中存在以下情况时，标记 `Architect-Review-Needed`：
  - 模块边界不清晰
  - 超出已知 Skills 覆盖范围
  - 存在循环依赖风险

**Skills 配置**
- 任务解析 Skill
- 领域模块边界识别 Skill
- 平台集成知识图谱 Skill

**KPI 指标**

| 指标 | 目标值 | 预警线 |
|---|---|---|
| 任务分解准确率（无需人工调整的比例） | ≥ 85% | < 70% |
| 任务链生成耗时 | ≤ 5 分钟 | > 15 分钟 |
| 错误上报率（上报后确认为真实问题的比例） | ≥ 80% | < 60% |

---

### 3.2 Spec Agent — 方案官

**岗位定位**：技术方案的"起草人"，替代冗长的技术评审会，通过异步文档完成方案对齐。

**核心输入**
- Orchestrator 分配的子任务详情
- 当前系统的 OpenAPI 契约文件（YAML）
- 相关模块的 ERD（实体关系图）
- 历史变更记录（近 3 个 Sprint）

**核心输出 — `Implementation_Plan.md`**

```markdown
## Implementation Plan: [任务名称]

### 影响范围
- 新增/修改文件列表（精确到文件路径）
- 数据库变更（表结构/索引/存储过程）
- 外部依赖变更（第三方 API 版本等）

### 接口变更说明
- 新增接口：[OpenAPI YAML diff]
- 修改接口：[before/after 对比]
- 废弃接口：[废弃时间表]

### 潜在风险点
- 向前兼容性风险
- 并发/性能风险
- 业务逻辑边界 Case

### 预估工时
- Coding Agent 预计编码时间
- Test Agent 预计测试时间
```

**Contract-First 约束**
> ⚠️ 方案必须以 OpenAPI YAML 变更为核心。任何接口设计不得绕过契约先行原则——**先有契约，才有代码**。

**方案审批机制**
- 提交 PR（Draft 状态），在 Description 中 `@对应架构师`
- 架构师在评论区回复 `Approved` 后，Spec Agent 将 Plan 传递给 Coding Agent
- **此步骤替代了冗长的技术方案评审会**

**禁止行为**
- ❌ 直接生成实现代码
- ❌ 跳过方案审批步骤
- ❌ 自行修改已确认的接口契约

**Skills 配置**
- Contract-First Skill
- 系统影响分析 Skill
- 数据库设计规范 Skill
- 团队历史 PR 模式 Skill

**KPI 指标**

| 指标 | 目标值 | 预警线 |
|---|---|---|
| 方案一次审批通过率 | ≥ 75% | < 50% |
| 方案完整度（三要素覆盖率） | 100% | < 95% |
| 方案生成耗时 | ≤ 30 分钟 | > 2 小时 |

---

### 3.3 Coding Agent — 研发官

> 🔑 **核心角色**：Coding Agent 是数字员工集群的核心生产力单元。一个 In-house 员工可同时调度 **2-4 个 Coding Agent** 并行处理不同模块，是实现"以一当十"的关键。

**岗位定位**：代码的实际生产者，严格在 Spec Agent 的方案框架内工作，不做任何计划外的自由发挥。

**核心输入**
- Spec Agent 的 Approved `Implementation_Plan.md`
- OpenAPI 契约（接口实现的唯一真相来源）
- 领域 Skills（核销逻辑、权益金规则、搭售规则等）
- 公司代码规范 Skills

**核心输出**
- 业务实现代码（严格在 Plan 定义的文件范围内）
- 单元测试骨架（供 Test Agent 扩充）
- 简要代码注释（说明关键业务逻辑的 WHY）

**编码约束（硬性规则）**
- 只能修改 Implementation Plan 中列明的文件，**禁止修改计划外文件**
- 接口实现必须与 OpenAPI 契约 100% 对齐，偏差由 Test Agent 标记为 BLOCKER
- 不得引入 Check-Dependency 未通过的依赖

**自修复循环机制**

```
Coding Agent 提交代码
  → Test Agent 运行测试
  → 若测试失败：失败日志 + 错误堆栈 → 回传 Coding Agent
    → Coding Agent 分析根因 → 修改代码 → 重新触发测试
    → 最多循环 3 次
  → 若 3 次后仍失败：标记 Human-Intervention-Needed
  → 若测试通过：代码传递给 Review Agent
```

**模块专业化配置**

Coding Agent 可配置为特定模块专家，例如：
- **核销模块 Agent**：深度预训练核销规则、退款流程、并发扣减逻辑
- **平台适配 Agent（JD）**：专注京东订单状态同步、回调处理、异常重试
- **权益系统 Agent**：专注 Coupon、Gift Card、Stars 权益金规则

**并行调度规则**

| In-house 员工数 | 可并行 Coding Agent 数 | 适用场景 |
|---|---|---|
| 1 人 | 2-3 个 | 同一模块的不同功能 |
| 1 人 | 4 个 | 不同模块并行（需模块边界清晰） |
| 2 人 | 6-8 个 | 大型跨模块项目 |
| > 4 个/人 | ❌ 不推荐 | 监管质量下降，风险增加 |

**Skills 配置**
- 公司代码规范 Skill（命名/注释/复杂度）
- 领域业务 Skill（核销/权益金/搭售——按模块专业化）
- 平台适配 Skill（JD / Douyin / 小程序）
- 自修复分析 Skill（错误模式识别）

**KPI 指标**

| 指标 | 目标值 | 预警线 |
|---|---|---|
| FPR（一次性通过测试+Review 的比例） | ≥ 80% | < 60% |
| Self-Fix Rate（自修复成功率） | ≥ 85% | < 70% |
| 契约偏差率（代码偏离 OpenAPI 的比例） | 0% | > 2% |
| 领域语义准确率（Domain Semantic Score） | ≥ 85% | < 70% |

---

### 3.4 Test Agent — 测试官

**岗位定位**：质量的"守门员"，与 Coding Agent 并行工作，驱动自修复循环，生成最终覆盖率报告供 In-house 签收。

**核心输入**
- Coding Agent 产出的代码
- OpenAPI 契约（Contract Test 的依据）
- 业务场景库 Skills（核销流程、支付回调、退款链路等）
- DoD 中定义的测试覆盖要求

**测试层次设计**

```
Layer 1: 单元测试（Unit Test）
  └── 业务逻辑正确性
  └── 边界 Case：金额边界、并发扣减、空值处理
  └── 覆盖率要求：行覆盖率 ≥ 80%

Layer 2: 契约测试（Contract Test）
  └── 基于 OpenAPI YAML 自动生成
  └── 验证接口输入输出与契约 100% 匹配
  └── 偏差标记为 BLOCKER 级别

Layer 3: 业务场景测试（Scenario Test）
  └── 核销全流程（下单→核销→库存扣减）
  └── 支付回调异常处理（超时/重复回调/金额不符）
  └── 权益发放边界（余额不足/已过期/并发领取）
  └── 覆盖率：关键业务路径 ≥ 95%
```

**驱动自修复的协议**

Test Agent 向 Coding Agent 回传的失败报告，必须包含：

```json
{
  "failedTest": "测试用例名称",
  "expectedBehavior": "期望行为描述",
  "actualBehavior": "实际行为描述",
  "errorStack": "完整错误堆栈",
  "suggestedFix": "Test Agent 的修复建议（可选）",
  "severity": "BLOCKER | CRITICAL | MAJOR"
}
```

**契约测试特殊职责**

> 当 Coding Agent 生成的代码与 OpenAPI 契约产生任何偏差时，Test Agent **必须**将其标记为 `BLOCKER` 级别，阻断后续流程，直至 Spec Agent 或架构师确认契约变更。

**最终报告格式**

Test Agent 生成的覆盖率报告直接呈现给 In-house 员工签收，包含：
- 总体覆盖率（行/分支/方法）
- Contract Test 100% 通过确认
- 未覆盖的高风险路径说明
- 建议的补充测试 Case（非强制）

**Skills 配置**
- JUnit / TestNG 测试设计 Skill
- Contract Test（OpenAPI 驱动）Skill
- 业务场景库 Skill（核销流程/支付回调/退款逻辑）
- 边界 Case 识别 Skill

**KPI 指标**

| 指标 | 目标值 | 预警线 |
|---|---|---|
| 行覆盖率 | ≥ 80% | < 65% |
| Contract Test 通过率 | 100% | < 100% |
| 漏测率（上线后发现的 Bug 中未被覆盖的比例） | < 5% | > 15% |
| 测试生成耗时 | ≤ 代码编写时间 × 1.5 | > × 3 |

---

### 3.5 Review Agent — 审计官

**岗位定位**：代码的"独立审计师"，替代人工 Code Review，生成结构化审计报告供 In-house 员工快速签收。

**核心输入**
- Test Agent 通过后的 PR
- 公司《安全编码规范》
- SonarQube 规则集
- 团队《代码质量标准》
- Skills 中沉淀的历史 Bug 模式库

**三维审计框架**

```
维度 1：安全审计（Security）
  ├── SQL 注入风险
  ├── XSS / CSRF 漏洞
  ├── 越权访问（未正确校验用户权限）
  ├── 敏感信息硬编码（密码/密钥/PII）
  └── 依赖库已知 CVE 漏洞

维度 2：性能审计（Performance）
  ├── N+1 查询问题
  ├── 慢 SQL（缺失索引/全表扫描）
  ├── 内存泄漏风险
  ├── 不合理的同步调用（应改为异步）
  └── 缓存策略缺失

维度 3：规范审计（Standards）
  ├── 命名规范违例
  ├── 注释完整性
  ├── 圈复杂度超限（> 10）
  ├── 代码重复率（DRY 原则）
  └── 异常处理规范
```

**输出格式（Review Report）**

每条问题必须包含：

```markdown
## [BLOCKER] SQL 注入风险 — OrderService.java:128

**问题描述**：直接拼接用户输入构造 SQL 查询语句，存在注入风险。

**风险等级**：BLOCKER（阻断合并）

**问题代码**：
```java
String sql = "SELECT * FROM orders WHERE id = " + orderId;
```

**修复建议**：
```java
String sql = "SELECT * FROM orders WHERE id = ?";
preparedStatement.setString(1, orderId);
```

**参考规范**：公司安全编码规范 §3.2.1
```

**问题严重级别定义**

| 级别 | 定义 | 处置方式 |
|---|---|---|
| BLOCKER | 必须修复才能合并，涉及安全/功能正确性 | 阻断合并，回传 Coding Agent 重修 |
| CRITICAL | 强烈建议修复，影响性能或可维护性 | 本次合并前修复，或提 Issue 跟踪 |
| MAJOR | 规范违例，影响代码质量 | Review Agent 自动生成修复 Patch |
| MINOR | 风格建议，可选修复 | 在报告中注明，不阻断合并 |

**自动修复能力**

> MINOR 级别问题：Review Agent 直接生成修复 Patch，提交至同 PR 的独立 Commit，附注 `[AutoFix by Review Agent]`，In-house 员工可一键接受。

**与 In-house 的配合模式**

In-house 员工只需：
1. 确认所有 `BLOCKER` 问题已解决
2. 查看 `CRITICAL` 问题是否已处理或创建跟踪 Issue
3. 一键点击 `Merge`

**完全不需要**逐行阅读 Review 报告的每条细节。

**Skills 配置**
- 安全编码 Skill（OWASP Top 10 + 公司规范）
- SonarQube 规则集 Skill
- 历史 Bug 模式库 Skill（从过往线上事故中提炼）
- 团队代码规范 Skill

**KPI 指标**

| 指标 | 目标值 | 预警线 |
|---|---|---|
| Review 误报率（标记为问题但实际无误的比例） | < 10% | > 25% |
| BLOCKER 发现率（上线后 Bug 中 Review 应发现但未发现） | < 3% | > 10% |
| Review 耗时 | ≤ 10 分钟/PR | > 30 分钟 |

---

### 3.6 Smoke Agent — 巡检官（SITC 特色扩展）

> 💡 **SITC 特有角色**：针对星巴克多平台交易场景（JD / Douyin / 自营小程序）的特殊需求设计，是 Gemini 原方案中未包含的关键角色，专门负责集成链路的端到端验证。

**岗位定位**：集成环境的"质检员"，在代码合并前模拟真实业务场景，确保多平台集成链路的健康性。

**触发时机**

```
Review Agent 通过
  → Smoke Agent 自动触发（无需人工干预）
  → 在 Staging 环境执行集成链路验证
  → 生成 Smoke 报告
  → 通过后，代码进入 In-house 签收环节
```

**场景库设计**

```
核心交易链路（必须 100% 覆盖）：
  ├── JD 平台
  │   ├── 正常链路：下单 → JD 回调 → 核销核验 → 库存扣减 → 状态同步
  │   ├── 异常链路：回调超时重试 / 重复回调幂等 / 金额不符处理
  │   └── 边界链路：并发下单 / 库存临界值 / 跨天订单
  ├── Douyin 平台
  │   ├── 正常链路：支付成功 → 权益发放 → 通知触达
  │   ├── 异常链路：支付回调延迟 / 权益发放失败回滚
  │   └── 边界链路：限时权益并发领取 / 权益余额不足
  └── 自营小程序
      ├── 退款全链路（申请→审核→退款→状态同步）
      └── 跨平台权益合并消费

非核心链路（≥ 80% 覆盖）：
  ├── 营销活动配置变更影响验证
  └── 会员等级变更联动验证
```

**Mock 平台配置**

使用官方 Sandbox 或内部 Mock Server，模拟：
- 正常响应（200ms / 500ms / 1000ms 三种延迟）
- 超时场景（3s / 10s / 30s）
- 错误响应（4xx / 5xx / 网络中断）
- 重复回调（相同请求发送 3 次）

**失败处置流程**

```
Smoke 失败
  → 生成链路失败报告（精确到失败节点）
  → 直接阻断合并流程
  → 通知 Coding Agent：失败节点 + 错误详情 + 预期行为
  → 同一链路失败 3 次 → 升级至平台整合工程师
```

**Skills 配置**
- JD 平台适配 Skill（订单状态机 / 回调协议）
- Douyin 集成 Skill（支付回调 / 权益 API）
- 交易场景库 Skill（覆盖已知异常模式）
- 异常注入 Skill（Chaos 测试方法论）

**KPI 指标**

| 指标 | 目标值 | 预警线 |
|---|---|---|
| 核心链路覆盖率 | 100% | < 100% |
| 非核心链路覆盖率 | ≥ 80% | < 65% |
| Smoke 首次通过率 | ≥ 90% | < 75% |
| Smoke 执行耗时 | ≤ 15 分钟 | > 45 分钟 |

---

### 3.7 Doc Agent — 文档官

**岗位定位**：团队知识的"沉淀者"，确保数字员工集群的运行不会造成知识孤岛，让 In-house 员工始终掌握系统全局。

**触发时机**
- 每次 PR 合并后**自动触发**（增量更新）
- 每周五定时**全量汇总**（周报）
- 架构师手动触发（重要架构决策记录）

**三类核心产出**

**产出 1：PR 变更日志**

```markdown
## 变更日志：[PR 标题] — [日期]

### 背景（WHY）
[这次变更解决了什么业务问题]

### 变更内容（WHAT）
- 新增/修改的核心文件
- 接口契约变更摘要
- 数据库变更说明

### 实现方式（HOW）
[关键技术决策和选型理由]

### 影响范围
[受影响的上下游系统和模块]

### 回滚方案
[如何回滚本次变更]
```

**产出 2：Wiki 更新**
- 自动识别 PR 中影响到的 Wiki 页面
- 生成 Wiki 更新 Draft，@对应模块负责人审批
- 更新模块架构图（Mermaid 格式）

**产出 3：Skills 库增量更新建议**
- 分析本周所有 Agent 的修复记录
- 提炼出新的业务规律（如：新发现的边界 Case 处理模式）
- 提炼出新的 Bug 模式（如：某类并发问题的规避方案）
- 提交 Skills PR，由架构师/知识管理员审批合并

**反熵机制**

> 定期扫描 Wiki 中超过 **90 天未更新**的页面，自动标记为"待验证"，生成 Issue 分配给对应模块负责人，防止文档腐化。

**输出质量要求**
- 生成文档的可读性由 In-house 员工月度评分
- 满意度评分 ≥ 80% 方可计入正向 KPI
- 低于 60% 触发 Doc Agent 的 Prompt 优化

**Skills 配置**
- 技术写作 Skill（中文技术文档规范）
- Wiki 结构规范 Skill（Confluence 页面模板）
- Skills 库管理 Skill（Skills 提炼方法论）
- 变更影响分析 Skill

---

## 四、In-house 与 Agent 集群协同模型

协同模型定义了"人"与"数字员工集群"之间的权责边界、通信协议和决策机制。

**核心原则**：人做判断，Agent 做执行；人看结果，Agent 看过程。

### 4.1 协同角色层级

| In-house 角色 | 职责定位 | 对应 Agent 管辖范围 |
|---|---|---|
| **架构师**（指挥官 / Architect） | 制定任务标准、审批技术方案、最终合并签收 | 统管全部 7 个 Agent，有终止任何 Agent 任务的权力 |
| **模块负责人**（Module Owner） | 拆解模块级需求、监管模块内 Agent 产出质量 | 直接管理 Coding Agent × 2-3 + Test Agent × 1 |
| **质量负责人**（QA Lead） | 制定测试策略、审核 Test Agent 场景覆盖度 | 管理 Test Agent + Smoke Agent，设定覆盖率阈值 |
| **平台整合工程师**（Integration Engineer） | 维护平台适配 Skills、处理 Smoke 失败根因 | 重点关注 Smoke Agent 报告，直接介入集成修复 |
| **知识管理员**（Knowledge Steward） | 审批 Doc Agent 提交的 Skills 更新 PR | 管理 Doc Agent，决策 Skills 库的纳入/淘汰 |

### 4.2 标准研发循环协同时序

以下是一个完整功能需求从接入到合并的标准时序。**黄色标注为 In-house 关键介入点。**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P0 ★ [架构师 — 主动发起] — 预计 30 分钟
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：创建带三要素（Input/Output/DoD）的 Jira Issue
  标注：#Agent-Task
  输出：规范化 Issue 文档

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P1 [Orchestrator Agent — 自动] — 约 5 分钟
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：解析 Issue → 生成任务链 DAG → 分配各 Agent
  输出：任务链 JSON
  In-house：仅审阅异常上报（不介入正常流程）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P2 ★ [Spec Agent 起草 + 架构师审批] — 审批 15 分钟
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：Spec Agent 生成 Implementation_Plan.md → 提交 Draft PR
  In-house：架构师审批方案 → 回复 Approved
  输出：已确认的技术方案 + 接口契约变更

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P3-P4 [Coding Agent + Test Agent — 并行自动] — 完全自动化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：
    Coding Agent 按 Plan 编码（可多个并行）
    Test Agent 同步生成测试
    自修复循环（最多 3 轮）
  In-house：不介入（仅在收到 Human-Intervention-Needed 时处理）
  输出：业务代码 + 完整测试 + 覆盖率报告

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P5 ★ [Review Agent 审计 + 架构师确认] — 确认 10 分钟
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：Review Agent 三维审计 → 生成分级 Review 报告
  In-house：确认所有 BLOCKER 已解决，CRITICAL 已处理/跟踪
  输出：通过审计的代码 PR

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P6 [Smoke Agent — 自动] — 完全自动化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：端到端链路验证（JD/Douyin/小程序多平台场景）
  In-house：不介入（仅查看 Smoke 报告摘要）
  输出：Smoke 通过报告

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P7 ★ [架构师 — 最终签收] — 约 20 分钟
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：查阅三份报告（测试覆盖率 + Review 报告 + Smoke 报告）
  In-house：一键 Merge
  输出：代码合并到目标分支

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
P8 [Doc Agent — 异步自动] — 后台运行
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  动作：生成变更日志 → 更新 Wiki → 提交 Skills 增量 PR
  In-house：异步审批 Skills 更新 PR（非阻塞）
  输出：文档 + Skills 库更新
```

> ⏱ **时间价值对比**
>
> | 模式 | In-house 有效介入时间 | 总周期 |
> |---|---|---|
> | 传统外包模式 | 2-3 天（对齐会议/返工沟通） | 5-10 天 |
> | 数字员工模式 | **约 75 分钟**（P0: 30 + P2: 15 + P5: 10 + P7: 20） | 1-2 天 |

### 4.3 In-house 员工的工作模式转型

| 过去做什么 | 转型后做什么 | 能力要求变化 |
|---|---|---|
| 写功能性代码 | 设计 Agent 任务规格（Input/Output/DoD） | 需求结构化能力 ↑ |
| 参加技术评审会 | 审批 Spec Agent 的技术方案文档 | 系统设计判断力 ↑ |
| 做代码 Review | 查阅 Review Agent 报告，处理 BLOCKER | 安全和架构意识 ↑ |
| 手动写测试用例 | 设计测试场景库（交给 Test Agent 执行） | 测试策略能力 ↑ |
| 编写接口文档 | 维护 OpenAPI 契约（契约驱动下游） | Contract-First 思维 ↑ |
| 与外包对接沟通 | 监控 Agent 集群 Dashboard，处理异常上报 | Agent 调度管理能力 ↑ |
| 手工更新 Wiki | 审批 Doc Agent 提交的 Skills PR | 知识工程能力 ↑ |

### 4.4 异常处理与升级机制

| 异常类型 | 触发条件 | 升级对象 | SLA 响应时间 | 自动处置 |
|---|---|---|---|---|
| **自修复耗尽** | Coding Agent 3 轮自修复后仍失败 | 模块负责人 | ≤ 2 小时 | 暂停任务，标记 HINeeded |
| **方案冲突** | Spec Agent 检测到接口变更与已有契约冲突 | 架构师 | ≤ 1 小时 | 阻断后续任务链 |
| **BLOCKER 超时** | Review BLOCKER 超 48 小时未处理 | 架构师 + QA Lead | 立即 | 发送 Slack 告警 |
| **Smoke 多次失败** | 同一链路 3 次 Smoke 失败 | 平台整合工程师 | ≤ 4 小时 | 标记链路为"不稳定" |
| **Agent 越权行为** | Agent 尝试操作权限范围外的分支/文件 | DevOps + 架构师 | 立即 | 终止 Agent，触发安全审计 |
| **Skills 冲突** | Doc Agent 提交的 Skill 与现有规范矛盾 | 知识管理员 | ≤ 24 小时 | 阻断 Skills PR 合并 |
| **上下文污染** | Agent 引入了不在 Check-Dependency 清单中的依赖 | 架构师 | ≤ 2 小时 | 拦截 PR，发送告警 |

### 4.5 并行任务管理模型

In-house 员工监管多个并行 Agent 任务时，遵循以下优先级模型：

```
优先级 1：处理所有 Human-Intervention-Needed 标记（任何 Agent 上报）
优先级 2：处理 BLOCKER 级别的 Review 问题
优先级 3：方案审批（Spec Agent 等待 Approved）
优先级 4：最终合并签收（所有报告齐全后）
优先级 5：异步审批 Skills PR（Doc Agent 提交）

监控频率建议：
  每 2 小时 Check Dashboard 一次（日常工作中）
  Slack Bot 实时推送 Priority 1-2 级别事件
```

---

## 五、准出体系（Agent Offboarding）

数字员工的"准出"不是简单的终止，而是角色重配、Prompt/Skills 替换或版本迁移。建立明确的准出标准，防止劣化的 Agent 持续污染代码库。

### 5.1 主动退出场景

| 退出场景 | 触发条件 | 处置方式 |
|---|---|---|
| **能力退化** | 连续 2 周 FPR < 60% 且优化 Prompt 无效 | 该角色停用，替换为新配置实例，旧实例归档 |
| **模型版本升级** | 团队决定迁移到更高版本模型 | Staging 环境完成新实例准入验证后，原实例退出 |
| **业务模块归零** | 某平台集成（如 JD）被废弃 | 该专项 Agent 归档，Skills 迁移到通用库 |
| **Skills 严重污染** | Doc Agent 提交错误 Skills，影响 Coding Agent 输出质量 | 回滚 Skills 版本，触发全链路重验证 |
| **安全事件** | Agent 产生包含安全漏洞的代码且多次重复出现 | 立即停用，启动根因分析，修正对应 Skills |
| **架构重设计** | 因团队架构调整，原有角色设计不再适用 | 按新架构重新准入，原实例退出并出具交接文档 |

### 5.2 退出检查清单（Offboarding Checklist）

```
□ 1. 进行中任务处置
      确认该 Agent 所有进行中任务已被接管或移交给其他 Agent/In-house

□ 2. 历史产出归档
      归档该 Agent 的所有历史 PR 和产出
      打 Tag 注明：实例版本 / 运行期间 / 主要产出模块

□ 3. Skills 价值评估
      评估该 Agent 生产期间沉淀的 Skills 价值
      决策：保留 / 迁移到通用库 / 丢弃

□ 4. 安全事件后置处理（仅安全事件触发时）
      对该实例曾接触的所有代码做额外安全扫描
      生成安全审计报告，留存备查

□ 5. 能力图谱更新
      更新团队 Agent 能力图谱
      标注该角色的空缺和接替方案（避免能力断档）

□ 6. 退出报告生成
      由 Doc Agent 自动生成退出报告，包含：
        - 该实例的贡献指标（FPR/任务完成数/Skills 贡献）
        - 退出原因分析
        - 改进建议（给替代实例的配置建议）
```

### 5.3 周期性复评机制（定期体检）

即使 Agent 没有触发退出条件，也需要定期接受"体检"，防止能力衰减被忽视：

| 复评周期 | 复评内容 | 评估维度 | 结果处理 |
|---|---|---|---|
| **每周** | KPI 自动汇总报告 | FPR / Self-Fix Rate / Human-Touch Ratio | 超预警线自动通知对应 In-house 员工 |
| **每月** | Skills 对齐验证 | 业务规则是否与最新产品逻辑一致 | 需要更新 Skills 时，本月内完成 |
| **每季度** | 综合能力评估 | 全量 KPI 回顾 + 对比行业 Benchmark | 决定是否升级模型版本或重新配置 |
| **每年** | 战略对齐评估 | Agent 集群设计是否匹配团队发展方向 | 可能触发角色重新设计或集群扩容 |

---

## 六、治理体系与 KPI 矩阵

### 6.1 完整 KPI 矩阵

| 考核维度 | 指标名称 | 定义 | 目标值 | 预警线 | 适用角色 |
|---|---|---|---|---|---|
| **产出效能** | Agent-FPR | 一次性通过测试 + Review 的代码比例 | ≥ 80% | < 60% | Coding |
| **自愈能力** | Self-Fix Rate | Agent 独立修复 Bug 成功的比例（3 轮内） | ≥ 85% | < 70% | Coding |
| **方案质量** | Plan Approval Rate | 方案一次性获架构师审批通过的比例 | ≥ 75% | < 50% | Spec |
| **测试质量** | Coverage Rate | 代码行覆盖率（单元测试） | ≥ 80% | < 65% | Test |
| **契约对齐** | Contract Deviation Rate | 代码偏离 OpenAPI 契约的比例 | 0% | > 2% | Coding / Test |
| **人力节省** | Human-Touch Time | In-house 员工单任务有效介入时长 | < 90 分钟 | > 3 小时 | 全角色 |
| **链路安全** | Smoke Pass Rate | 端到端链路验证首次通过率 | ≥ 90% | < 75% | Smoke |
| **领域准确** | Domain Semantic Score | QSR 业务逻辑语义正确率 | ≥ 85% | < 70% | Coding |
| **知识活跃** | Skills Update Frequency | 每月 Skills 库有效增量条目数 | ≥ 5 条/月 | < 2 条 | Doc |
| **成本效率** | Token-vs-PSP | Token 费用 vs 同等外包服务费比例 | < 15% | > 30% | 集群整体 |
| **审计质量** | Review Accuracy | Review 报告误报率（标记问题但实为误判） | < 10% | > 25% | Review |
| **文档质量** | Doc Satisfaction | In-house 员工对 Doc Agent 产出的满意度评分 | ≥ 80% | < 60% | Doc |

### 6.2 人力节省 KPI 分类基准

针对 SITC 不同任务类型，`Human-Touch Time` 需分类统计：

| 任务类型 | 描述 | 目标值 | 说明 |
|---|---|---|---|
| **简单配置类** | 营销活动配置、参数调整、文案更新 | < 10 分钟 | 架构师只需最终确认 |
| **标准功能类** | 单模块新功能、接口新增、业务规则调整 | < 45 分钟 | 包含方案审批和最终签收 |
| **跨模块集成类** | 涉及 2+ 模块的功能 | < 90 分钟 | 需更多方案对齐 |
| **跨平台集成类** | 涉及 JD / Douyin / 小程序的集成改造 | < 2 小时 | Smoke 环节需人工关注 |

### 6.3 集群健康度仪表盘（Dashboard 设计）

建议在 GitLab / Confluence 搭建实时 Dashboard，包含以下模块：

| 模块名称 | 展示内容 | 刷新频率 | 告警阈值 |
|---|---|---|---|
| **Agent 任务流水线** | 各 Agent 当前任务状态、阻塞点、完成率 | 实时 | 任务阻塞 > 30 分钟 |
| **KPI 趋势图** | 过去 4 周各核心指标的趋势曲线 | 每日 | 连续 2 周低于预警线 |
| **人力节省统计** | 每周 Human-Touch Time 累计节省 vs 传统模式 | 每周 | — |
| **Skills 库健康度** | Skills 覆盖率、最近更新时间、使用频率热图 | 每周 | 超 30 天未更新的 Skill |
| **异常事件日志** | 过去 30 天的人工介入记录和根因分析 | 每日 | — |
| **成本对比报表** | Token 实际消耗 vs 外包费用对比（月度） | 每月 | Token-vs-PSP > 30% |

### 6.4 Skills 库治理规范

**纳入标准**（满足其中一项即可）：
- 被 3 个以上 Agent 任务引用过
- 解决了一个线上 Bug 或性能问题
- 覆盖了一种新的业务边界场景

**淘汰标准**（同时满足）：
- 连续 60 天未被任何 Agent 引用
- 对应业务模块已下线或重构

**版本管理**：
- Skills 库使用 Git 版本控制
- 每次 Skills 变更需 In-house 员工（知识管理员）审批
- 支持按 Skill 版本回滚（防止 Doc Agent 引入错误规则）

---

## 七、进化路径与实施计划

### 7.1 三阶段演进路径

#### Phase 1：单点突破（Month 1-2）

**核心目标**：以最低风险接入第一个 Agent，建立 CI/CD 集成和基础 KPI 数据积累。

**优先接入**：Review Agent + Test Agent

**理由**：
- 风险最低：仅在现有流程末端加层验证，不改变编码方式
- 效果最可见：Review 时间节省立即可见
- 数据积累：为后续 Agent 扩展提供 FPR / 覆盖率 Baseline

**里程碑**：
- Review Agent 覆盖 100% PR，误报率 < 20%
- Test Agent 在至少 1 个核心模块达到 ≥ 75% 覆盖率
- 建立 Dashboard 并收集 4 周 KPI 数据

**关键配置任务**：
- GitLab CI/CD 集成 Review Agent 和 Test Agent
- 建立公共 Skills 仓库（团队规范 + 安全编码 Skill）
- 定义告警和上报 Slack 集成

#### Phase 2：链路闭环（Month 3-4）

**核心目标**：接入 Orchestrator + Spec + Coding Agent，完成第一个完整数字员工研发循环。

**新增接入**：Orchestrator Agent + Spec Agent + Coding Agent（2 个并行）

**里程碑**：
- 完成首个端到端任务：从 Jira Issue 到代码合并，Human-Touch < 90 分钟
- 建立领域 Skills 库（核销/权益金/搭售逻辑）
- Contract-First 流程在至少 1 个模块全面推行

**关键配置任务**：
- Jira → GitLab 自动同步配置
- OpenAPI 契约库建立（存储所有接口定义）
- In-house 员工完成 Agent 调度能力培训（如何写高质量 Issue）

#### Phase 3：集群运营（Month 5-6）

**核心目标**：全角色上线，启动 Skills 自动沉淀，In-house 员工完成角色转型。

**新增接入**：Smoke Agent + Doc Agent

**里程碑**：
- Token-vs-PSP < 15%
- 团队对数字员工模式满意度 ≥ 80%
- Skills 库累计 ≥ 30 条有效 Skill，月更新率 ≥ 5 条
- 所有 In-house 员工完成角色转型

**关键配置任务**：
- JD / Douyin Mock Server 配置（Smoke Agent 基础设施）
- Doc Agent 与 Confluence/Wiki 系统集成
- 建立季度复评机制和年度战略评估机制

### 7.2 SITC MVP 推荐选点

> 🎯 **推荐 MVP**：第三方平台适配层标准化（JD / Douyin 订单状态同步接口）

**选择理由**：

| 评估维度 | 说明 |
|---|---|
| **逻辑清晰** | 平台适配代码边界明确，没有复杂业务规则依赖 |
| **重复性高** | 存在大量"适配胶水代码"，是 Coding Agent 最容易高质量产出的场景 |
| **可对比性强** | 历史外包任务有记录：沟通次数/返工次数/交付周期，对比效果一目了然 |
| **技能沉淀价值高** | 完成后产生的平台适配 Skills 可直接服务于 MCP 集成探索 |
| **风险可控** | 限定在非核心支付链路，线上影响可控 |

**MVP 执行方案**：

```
任务描述：JD 平台适配层 — 订单状态同步接口标准化改造

参与 Agent：
  Orchestrator（任务分解）
  Spec Agent（方案设计 + 接口契约）
  Coding Agent × 2（适配层实现 + 单元测试骨架）
  Test Agent（Contract Test + 场景测试）
  Review Agent（三维审计）

时间目标：48 小时内完成从"需求描述"到"带完整测试的 PR 合并"

对比指标记录：
  - 外包模式：需求对齐会议次数 / 往返沟通 Ticket 数 / 实际交付天数
  - 数字员工模式：Human-Touch Time / FPR / 自修复次数

沉淀价值：
  产出的"JD 平台适配 Skill"进入团队 Skills 库
  为后续 Douyin / 小程序适配提供参考模板

风险控制：
  首次 MVP 限制在非核心支付链路（如状态查询接口）
  测试环境完整验证后，再切换生产
```

### 7.3 团队能力建设路线

与数字员工集群并行，In-house 员工需要建立以下新能力：

| 能力域 | 具体能力 | 培养方式 | 目标时间 |
|---|---|---|---|
| **任务规格化** | 写出高质量的 Input/Output/DoD 三要素 Issue | 每月 1 次 Workshop + 模板训练 | Month 1 完成 |
| **契约设计** | 熟练使用 OpenAPI 3.0 设计接口契约 | 内部 Contract-First 手册 + 工具培训 | Month 2 完成 |
| **Agent 调度** | 合理分配并行 Agent 数量，处理异常上报 | 实战 OJT（On-the-Job Training） | Month 3 完成 |
| **Skills 提炼** | 从代码和事故中提炼高价值 Skills | Doc Agent 产出 Review + 月度 Retrospective | Month 4 完成 |
| **集群诊断** | 通过 KPI 数据发现 Agent 能力问题并处置 | Dashboard 使用培训 + Case Study | Month 5 完成 |

---

## 附录：快速参考卡

### Agent 准入通关标准（一页纸版）

```
✅ 基础能力：代码生成 ≥ 85% / 任务完整执行 ≥ 90%
✅ 领域适配：QSR 术语 ≥ 80% / Lint 通过 ≥ 95% / 契约对齐 ≥ 95%
✅ 安全合规：无 PII 暴露 / 无越权操作 / 依赖合法
✅ 试岗验证：综合评分 ≥ 75%（5 个工作日）
```

### 研发循环 In-house 介入清单

```
① 创建 Issue（30 min）：三要素齐全
② 审批方案（15 min）：回复 Approved
③ 确认 BLOCKER（10 min）：全部解决
④ 最终签收（20 min）：三份报告通过
⑤ 审批 Skills（异步）：评估 Doc Agent 提交
```

### 紧急情况处置速查

```
Agent 越权操作 → 立即终止 + 通知 DevOps + 安全审计
BLOCKER 超 48h → Slack 告警 + 架构师接管
Smoke 三连失败 → 升级平台整合工程师
Agent FPR 连续 2 周 < 60% → 进入准出流程
```

---

> **文档版本**：v1.0 · SITC Trading Team
> **维护建议**：每个实施 Phase 结束后更新本文档，保持与实际运行状态一致
> **下一步**：参考第七章实施计划，启动 Phase 1（Review Agent + Test Agent 接入）
